---
title: "Check_results"
author: "Carmen"
date: "March 23, 2018"
output: html_document
---

```{r}
library(tidyverse)
library(raster)
library(sp)
```


```{r}
setwd("~/drought_tree_carbon/drought_tree_carbon/results/")
ag <- read.csv("tables_aggregated/Madera_aggregated.csv")
load("Results_Table_Madera.Rdata")
load("Results_Spatial_Madera.Rdata")
```

## Change columns to numeric
```{r}
head(ag)
ag[3:6] <- lapply(ag[,3:6],as.character)
ag[3:6] <- lapply(ag[,3:6],as.numeric)
head(ag)
```


```{r}
sumag <- ag %>% 
  summarise(liveBM = sum(na.omit(BM_live_2012_kg)), deadBM=sum(na.omit(D_BM_kg)), deadT = sum(na.omit(relNO_tot)), liveT = sum(na.omit(NO_TREES_PX)))
sumag            
```

```{r}
sumag$deadBM/sumag$liveBM
sumag$deadT/sumag$liveT
```

# Sum live biomass and live number of trees across the different data sets
```{r}
sum(spdf$BM_live_2012_kg)
sum(df$BM_live_2012_kg)
sum(na.omit(ag$BM_live_2012_kg))
```

## Troubleshoot
```{r}
sum(df$BM_live_2012_kg)/sum(na.omit(ag$BM_live_2012_kg))
```


.
.
.
.
.
Lots of live biomass in the aggregated data are missing. Why? Try the whole aggregation process and check live biomass along the way

# Look for error using the method that does not break up the raster
```{r}
sum(spdf$BM_live_2012_kg)
```

## make raster
```{r}
xyz <- spdf@data %>% 
    dplyr::select(x, y, BM_live_2012_kg, D_BM_kg, relNO_tot, NO_TREES_PX)
sum(xyz$BM_live_2012_kg)
raster <- rasterFromXYZ(xyz, crs= crs(spdf))
sum(na.omit(raster[[1]]@data@values))
```

## aggregate
```{r}
ag <- aggregate(raster, fact = 33, fun = sum)
sum(na.omit(ag[[1]]@data@values))
sum(xyz$BM_live_2012_kg) 

df <- as.data.frame(ag)

```

